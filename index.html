<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bad Apple ASCII Player</title>
    <style>
        body {
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: monospace;
            /* 글자가 깨지거나 흐려지지 않도록 설정 */
            -webkit-font-smoothing: none; 
        }

        #ascii-screen {
            font-size: 10px; 
            line-height: 10px; 
            white-space: pre; 
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: white;
            color: black;
            border: none;
            border-radius: 5px;
        }

        #loading {
            color: yellow;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div id="loading">데이터를 불러오는 중입니다... 잠시만 기다려주세요.</div>
    <div id="ascii-screen"></div>
    <button id="play-btn" disabled>재생 / 일시정지</button>

    <script>
        const screen = document.getElementById('ascii-screen');
        const playBtn = document.getElementById('play-btn');
        const loadingText = document.getElementById('loading');
        
        // 오디오 파일 이름이 bad_apple.mp3 라고 가정합니다.
        const audio = new Audio('bad_apple.mp3'); 
        
        let frames = [];
        let isPlaying = false;
        let intervalId;
        const fps = 30; // 원본 영상과 같은 30 프레임

        // 1. JSON 데이터 파일 불러오기
        // 깃허브에 같이 올라간 bad_apple_data.json 파일을 읽어옵니다.
        fetch('bad_apple_data.json')
            .then(response => response.json())
            .then(data => {
                frames = data;
                loadingText.style.display = 'none'; // 로딩 메시지 숨기기
                screen.textContent = "준비 완료! 재생 버튼을 누르세요.";
                playBtn.disabled = false; // 버튼 활성화
            })
            .catch(error => {
                loadingText.textContent = "데이터를 불러오는데 실패했습니다.";
                console.error("Error loading JSON:", error);
            });

        // 2. 화면 업데이트 함수
        function renderFrame() {
            // 오디오의 현재 재생 시간(초)을 기준으로 프레임 번호를 계산합니다.
            // 이렇게 하면 음악과 영상의 싱크가 정확히 맞습니다.
            let currentFrame = Math.floor(audio.currentTime * fps);
            
            if (currentFrame < frames.length) {
                screen.textContent = frames[currentFrame];
            } else {
                stopPlaying(); // 영상이 끝나면 정지
            }
        }

        function startPlaying() {
            isPlaying = true;
            audio.play();
            intervalId = setInterval(renderFrame, 1000 / fps);
        }

        function stopPlaying() {
            isPlaying = false;
            audio.pause();
            clearInterval(intervalId);
        }

        // 3. 버튼 클릭 이벤트
        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                stopPlaying();
            } else {
                startPlaying();
            }
        });
    </script>
</body>
</html>
